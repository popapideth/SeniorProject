<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ทดสอบเสียง</title>
    <script src="/static/sounds.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background: #f8f9fa; }
        .card { margin: 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn-test { margin: 10px; min-width: 200px; }
        .volume-control { width: 200px; margin: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="card-header">
                <h2>ทดสอบเสียงแจ้งเตือน</h2>
            </div>
            <div class="card-body">
                <div class="mb-2">
                    <button id="enable_audio" class="btn btn-outline-primary">Enable Audio</button>
                    <small class="text-muted ms-2">(กดครั้งเดียวเพื่อเปิดเสียงในเบราว์เซอร์)</small>
                </div>

                <div class="mb-4">
                    <h5>เสียงเมื่อทำครบ 1 รอบ</h5>
                    <div class="d-flex align-items-center">
                        <button class="btn btn-primary btn-test" onclick="completeSound.play()">ทดสอบเสียง 1 รอบ</button>
                        <div class="volume-control">
                            <label>ความดัง: <span id="vol1">100%</span></label>
                            <input type="range" class="form-range" min="0" max="100" value="100" onchange="updateVolume(completeSound, this.value, 'vol1')">
                        </div>
                    </div>
                </div>

                <div class="mb-4">
                    <h5>เสียงเมื่อทำครบทุกรอบ</h5>
                    <div class="d-flex align-items-center">
                        <button class="btn btn-success btn-test" onclick="allCompleteSound.play()">ทดสอบเสียงครบทุกรอบ</button>
                        <div class="volume-control">
                            <label>ความดัง: <span id="vol2">100%</span></label>
                            <input type="range" class="form-range" min="0" max="100" value="100" onchange="updateVolume(allCompleteSound, this.value, 'vol2')">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function updateVolume(sound, value, displayId) {
            try { sound.volume = value / 100; } catch(e) {}
            document.getElementById(displayId).textContent = value + '%';
        }

        document.getElementById('enable_audio').addEventListener('click', async () => {
            try {
                if (typeof enableAudio === 'function') await enableAudio();
            } catch (e) { console.warn('enable audio', e); }
            // play and pause quickly to unlock audio in some browsers
            try { completeSound.play().then(() => completeSound.pause(), () => {}); } catch(e) {}
            document.getElementById('enable_audio').disabled = true;
        });
    </script>
</body>
</html>
